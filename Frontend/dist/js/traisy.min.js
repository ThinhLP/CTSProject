/*! traisy 2018-03-10 (c) 2018 ThinhLP */
"use strict";function Collapse(a,b,c,d){b||(b=300);var e,f="collapsed",g="target",h=d||function(a,b){},i=function(a){h=a},j=function(a){e=a},k=function(a){},l=function(a){k=a},m=[],n=function(){return $(a).attr(g)},o=function(){return $(a).attr(f)},p=function(a,d,f){if(c)return a&&e&&e.call(this,a,d),void $(f).slideToggle(b,function(){m[f]=!1,a&&h.call(this,a,d)});d?$(f).hide():$(f).show(),m[f]=!1,a&&h.call(this,a,d)},q=function(){p(null,!0,$(n())),$(a).attr(f,"true"),k()},r=function(){p(null,!1,$(n())),$(a).attr(f,"false")},s=function(a){return!0},t=function(a){s=a};return $(document).on("click",a,function(b){var c=$(b.target);if(c.attr(f)||(c=c.parents(a)),s(c)){var d=c.attr(f),e=c.attr(g),h=!0;m[e]||(m[e]=!0,"true"===d&&(h=!1),c.attr(f,h),p(b,h,e))}}),{ATTRIBUTES:{target:g,collapse:f},onClick:i,collapse:q,expand:r,getCurrentStatus:o,getCurrentCollapseTargetSelector:n,setCondition:t,collapsedCallback:l,onBeforeToggle:j}}function ContentTab(a,b,c){var d=b||"active",e="target",f=a.substring(1),g=f+"-inactive-tab",h="."+g,i=null,j=new EventBus,k={ON_CHANGE_TAB:"onChangeTab"},l=function(a){j.on(k.ON_CHANGE_TAB,a)},m=function(b){b.siblings(a).each(function(){var a=$(this).attr(e);$(this).removeClass(d),$(this).addClass(g),$(a).hide()})},n=null,o=function(){if(null!==n){var b=$(n);b.hasClass(f)||(b=b.closest(a));var c=b.attr(e);m(b),b.addClass(d),b.removeClass(g),$(c).show(),j.dispatch(k.ON_CHANGE_TAB,n)}},p=function(b){$(a).eq(b).trigger("click")},q=function(){$("body").on("click",a,function(a){n=a.target,null!==i&&void 0!==i||o()}),$(a).each(function(){$(this).hasClass("active")&&$(this).trigger("click")}),null!==c&&void 0!==c&&(r(),i=new ConfirmDialog({openButtonSelector:h,modalSelector:c.modalSelector,closeButtonSelector:c.closeButtonSelector}),i.onClickYes(function(){o()}))},r=function(){$(a).each(function(a){$(this).hasClass("active")||($(this).removeClass(g),$(this).addClass(g))})};return q(),{onChangeTab:l,onclickTab:p,initInactiveTab:r}}function DragNDrop(a){var b=a.containerSelector,c=a.handleSelector,d=a.cancelSelectors,e=a.connectSelector?a.connectSelector:"",f=a.containment?a.containment:"window",g=new EventBus,h={ON_SUCCESS:"onSuccess",ON_SORT:"onSort",ON_SORT_START:"onSortStart"},i=function(a){g.on(h.ON_SUCCESS,a)},j=function(a){g.on(h.ON_SORT,a)},k=function(a){g.on(h.ON_SORT_START,a)};$(b).sortable({handle:c,cancel:d,connectWith:e,containment:f});var l=function(){$(b).on("sortstop",function(a,b){g.dispatch(h.ON_SUCCESS,a,b)}),$(b).on("sort",function(a,b){g.dispatch(h.ON_SORT,a,b)}),$(b).on("sortstart",function(a,b){g.dispatch(h.ON_SORT_START,a,b)})},m=function(){$(b).sortable({handle:c,cancel:d,connectWith:e,containment:f}),l()},n=function(){$(b).sortable("refresh")};return l(),{onSuccess:i,onSort:j,refresh:n,reset:m,onSortStart:k}}function EventBus(){var a=[],b=function(b,c){a[b]||(a[b]=[]),a[b].push(c)},c=function(){var b=arguments[0],c=[];if(a[b]){for(var d=[],e=1,f=0;e<arguments.length;e++,f++)d[f]=arguments[e];var g=this;return a[b].forEach(function(a){c.push(a.apply(g,d))}),c}};return{on:b,off:function(b,c){if(a[b]){if(!c)return void(a[b]=void 0);var d=[];a[b].forEach(function(a){a===c||d.push(a)}),a[b]=d}},dispatch:c}}function HoverTooltip(a){var b={},c="target";return function(){$(document).on("mouseenter",a,function(){var a=$(this).attr(c);$(a).show(),$(a).mousemove(function(){$(a).show()}),$(a).mouseleave(function(){$(a).hide()})}),$(document).on("mouseleave",a,function(a){var b=$(this).attr(c);$(b).hide()})}(),b}function InlineInput(a){var b,c,d=a.confirmDialogSelector,e=a.startEditBtnSelector,f=a.tooltipSelector,g=(a.placeholder,""),h=new EventBus,i={CHANGE:"change",ON_VALIDATE:"validate"},j=function(a){h.on(i.CHANGE,a)},k=function(a){h.on(i.ON_VALIDATE,a)};$.fn.selectText=function(){var a=document,b=this[0];if(a.body.createTextRange){var c=document.body.createTextRange();c.moveToElementText(b),c.select()}else if(window.getSelection){var d=window.getSelection(),c=document.createRange();c.selectNodeContents(b),d.removeAllRanges(),d.addRange(c)}};var l=function(a,b){a?(b.attr("contenteditable","true"),b.css({cursor:"text"}),b.focus()):(b.attr("contenteditable","false"),b.css({cursor:"pointer"}))},m=function(){c=new ConfirmDialog({modalSelector:d,closeButtonSelector:".close-modal-button"}),c.onClickYes(function(a){var c=$(b).first().text();h.dispatch(i.CHANGE,a,c,$(b).first())}),c.onClickNo(function(a){$(b).first().text(g)})},n=function(a){"true"!==a.attr("contenteditable")&&(l(!0,a),a.selectText())},o=function(){$(document).on("click",e,function(a){var c=$(a.target);c.hasClass(e)||(c=c.closest(e)),b=c.attr("target"),b||(b=e),n($(b).first()),g=$(b).first().text().trim(),p(b)})},p=function(a){$(document).on("focusout",a,function(a){if("false"!=$(this).attr("contenteditable")){var d=$(this).text().trim();if(!d||0===d.length)return f&&e(),void $(this).focus();if(g!==d){var j=h.dispatch(i.ON_VALIDATE,d,$(b).first());void 0==j||1==j[0]?(c?c.show():h.dispatch(i.CHANGE,a,d,$(this)),l(!1,$(this))):(f&&e(),$(this).focus())}else l(!1,$(this))}});var d=function(){$(f).hasClass("tooltip")?Utils.hideTooltip(f):$(f).hide()},e=function(){$(f).hasClass("tooltip")?Utils.showTooltip(f):$(f).show()};$(document).on("keypress",a,function(a){if("false"!=$(this).attr("contenteditable"))if(13==a.keyCode){a.preventDefault();var e=$(this).text().trim();if(!e||0===e.length)return void $(this).focusin();if(g!==e){var j=h.dispatch(i.ON_VALIDATE,e,$(b).first());void 0!=j&&1!=j[0]||(c?c.show():h.dispatch(i.CHANGE,a,e,$(this)),l(!1,$(this)))}else l(!1,$(this))}else f&&d()})};return function(){d&&m(),o()}(),{onChange:j,onValidate:k,on:h.on,EVENT_NAMES:i}}function InputField(a,b){var c={},d="."+a.substr(1)+"-tooltip",e=function(){$(d).show(),$(a).addClass("has-error")},f=function(){b||(b="Không được để trống");var c='<div class="alert-tooltip '+d.substr(1)+'">                    <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>                    <span>'+b+"</span>                </div>";$(a).after(c)},g=function(){$(d).hide(),$(a).removeClass("has-error")};return function(){f(),$(a).on("keypress",function(){g()}),$(a).on("focusin",function(){g()})}(),c.notify=e,c.hideError=g,c.tooltipSelector=d,c.value=function(){return $(a).val()},c}function PopupTooltip(a,b,c,d){var e=Collapse.call(this,a,b,c,d),f=function(a){var b=$(e.getCurrentCollapseTargetSelector());Utils.isMouseClickOutside(a,b)&&"false"===e.getCurrentStatus()&&e.collapse()};return $(document).mouseup(function(b){$(b.target).is(a)||$(b.target).parents().is(a)||f(b)}),e}function ManageMasterpage(){var a={},b=1200,c=".hamburger-button",d=function(){"true"!=$(c).attr("collapsed")&&($(".left-panel").animate({width:0},250,function(){$(this).hide(),$(c).attr("collapsed","true")}),$(".fake-panel").animate({width:0},250,function(){$(this).hide(),$(".main-container").css("width","100%")}),$(".nav-top").animate({left:0},250),$(".nav-top").css("width","100%"))},e=function(){"true"==$(c).attr("collapsed")&&($(".left-panel").show(0,function(){$(this).animate({width:"225px"},250,function(){$(c).attr("collapsed","false")})}),$(".fake-panel").show(0,function(){$(this).animate({width:"225px"},250,function(){$(".main-container").css("width","calc(100% - 225px)")})}),$(".nav-top").animate({left:"225px",width:"calc(100% - 225px)"},250),$(".nav-top").css("width","calc(100% - 225px)"))},f=function(){$(window).width()<=b?$(c).attr("collapsed","true"):$(c).attr("collapsed","false")};$(c).click(function(){"true"==$(this).attr("collapsed")?e():d()});var g=(new ContentTab(".top-menu-item"),new PopupTooltip(".user-action",0),function(){f()}),h=function(){};return function(){g(),$(window).resize(function(){h()}),$(".modal").on("hidden.bs.modal",function(){var a=$(this).find("input");a.length>0&&a.val("")}),$(".modal").on("shown.bs.modal",function(){var a=$(this).find("input");a.length>0&&a.eq(0).focus()})}(),a}function MasterPage(){var a={},b=(new PopupTooltip(".right-panel-user-avatar",0),new HoverTooltip(".compact-nav-items li"),1200),c=function(){$(window).width()<=b?$(".nav-items").addClass("compact-nav-items"):$(".nav-items").removeClass("compact-nav-items")},d=function(){c()},e=function(){c()};return function(){d(),$(window).resize(function(){e()})}(),a}function PlanOverviewPage(){var a=MasterPage.call(this),b=".program-title",c=function(a,c){var d=a.closest(b).find("i");Utils.rotateArrow(d,c)};new Collapse(b,300,!0).onBeforeToggle(function(a,b){var d=$(a.target);c(d,b)});var d=function(){},e=function(){};return function(){d(),$(window).resize(function(){e()})}(),a}function ManageCourse(){var a=ManageMasterpage.call(this),b=new EventBus,c={UPDATE_SECTION_TITLE:"updateSectionTitle",ON_SUCCESS_DND_SECTION:"onSuccessDragNDropSection",ON_SUCCESS_DND_LECTURE:"onSuccessDragNDropLecture"},d=".expand-section",e=new Collapse(d,300,!0),f=function(a,b){var c=a.closest(d).find("i");Utils.rotateArrow(c,b)};e.onBeforeToggle(function(a,b){var c=$(a.target);f(c,b)}),e.onClick(function(){j.refresh()});var g=new InlineInput({startEditBtnSelector:".edit-section-title"});a.onUpdateSectionTitle=function(a){g.on(g.EVENT_NAMES.CHANGE,a)},a.onSuccessDragNDropSection=function(a){b.on(c.ON_SUCCESS_DND_SECTION,a)},a.onSuccessDragNDropLecture=function(a){b.on(c.ON_SUCCESS_DND_LECTURE,a)};var h=".right-panel",i=new DragNDrop({containerSelector:"#section-list",handleSelector:".move-section",containment:h});i.onSuccess(function(a,d){b.dispatch(c.ON_SUCCESS_DND_SECTION,a,d)});var j=new DragNDrop({containerSelector:".lecture-list-wrapper",handleSelector:".move-lecture",connectSelector:".lecture-list-wrapper",containment:h});j.onSuccess(function(a,d){b.dispatch(c.ON_SUCCESS_DND_LECTURE,a,d),a.stopPropagation()}),j.onSort(function(a,b){var c=b.offset.top,d=b.offset.left;$(".curriculum-item").each(function(){var a=$(this).offset(),b=$(this).find(".curriculum-heading"),e=b.outerHeight(),f=b.outerWidth(),g=$(this).find(".lecture-list-wrapper");Utils.isElementHidden(g)&&c>=a.top&&c<=a.top+e&&d>=a.left-10&&d<=a.left+f&&(b.find(".expand-section").first().trigger("click"),j.refresh())})}),a.resetSection=function(){i.reset()},a.resetLecture=function(){j.reset()};var k=function(a){var b="#section-"+a,c=b+" .sec-title-input",d=b+" .sec-title-action",e=b+" .section-name",f=b+" .sec-content-action",g=b+" .edit-sec-title-btn";$(c).show(),$(d).show(),$(f).hide(),$(g).hide(),$(e).hide(),$(c+" input").val($(e).text()),$(c+" input").select()},l=function(a,b,c){var d="#section-"+a,e=d+" .sec-title-input",f=d+" .sec-title-action",g=d+" .section-name",h=d+" .sec-content-action",i=d+" .edit-sec-title-btn";$(e).hide(),$(f).hide(),$(h).show(),$(g).show(),$(i).show(),b&&$(g).text(c)},m=function(a){var b="#lecture-"+a,c=b+" .lec-title-input",d=b+" .lec-title-action",e=b+" .lecture-name",f=b+" .lec-content-action",g=b+" .edit-lec-title-btn";$(c).show(),$(d).show(),$(f).hide(),$(g).hide(),$(e).hide(),$(c+" input").val($(e).text()),$(c+" input").select()},n=function(a,b,c){var d="#lecture-"+a,e=d+" .lec-title-input",f=d+" .lec-title-action",g=d+" .lecture-name",h=d+" .lec-content-action",i=d+" .edit-lec-title-btn";$(e).hide(),$(f).hide(),$(h).show(),$(g).show(),$(i).show(),b&&$(g).text(c)};return $("body").on("click",".edit-sec-title-btn",function(){var a=$(this).attr("value");k(a)}),$("body").on("click",".cancel-edit-sec-title",function(){var a=$(this).attr("value");l(a)}),$("body").on("click",".edit-lec-title-btn",function(){var a=$(this).attr("value");m(a)}),$("body").on("click",".cancel-edit-lec-title",function(){var a=$(this).attr("value");n(a)}),a.activeSectionEditableMode=k,a.cancelSectionEditableMode=l,a.activeLectureEditableMode=m,a.cancelLectureEditableMode=n,a}function ManagePlanDetail(){var a=ManageMasterpage.call(this),b=(new EventBus,".expand-program"),c=function(a,c){var d=a.closest(b).find("i");Utils.rotateArrow(d,c)};return new Collapse(b,300,!0).onBeforeToggle(function(a,b){var d=$(a.target);c(d,b)}),a}Collapse.prototype.constructor=Collapse;var Utils={isMouseClickOutside:function(a,b){return!b.is(a.target)&&0===b.has(a.target).length},rotateArrow:function(a,b){var c="fa-angle-down",d="rotate-active",e="rotate-reverse";b&&!a.hasClass(d)&&a.hasClass("fa-angle-up")?a.addClass(e):b&&!a.hasClass(d)&&a.hasClass(c)?a.addClass(d):b&&a.hasClass(d)&&a.hasClass(c)?a.removeClass(d):!b&&a.hasClass(c)?a.addClass(d):a.removeClass(e)},callJsonAjax:function(a,b,c,d,e){"GET"==b?$.ajax({url:a,type:"GET",success:function(a){d&&d(a)},error:function(a,b,c){e&&e(a,b,c)}}):$.ajax({url:a,headers:{Accept:"application/json","Content-Type":"application/json"},type:b,dataType:"json",data:JSON.stringify(c),success:function(a){d&&d(a)},error:function(a,b,c){e&&e(a,b,c)}})},showSnackbar:function(a,b){var c=$("#snackbar");b||(b=2500),c.text(a),c.addClass("show"),setTimeout(function(){c.removeClass("show")},b)},notify:function(a,b){$("#notify-modal .modal-title").text(a),$("#notify-modal .modal-body").text(b),$("#notify-modal").modal("show")},convertDateStringToTimeStamp:function(a){if(!a||0==a.length)return 0;a=a.split("/");var b=a[1]+"/"+a[0]+"/"+a[2];return new Date(b).getTime()},convertTimestampToSimpleDate:function(a){if(!a||null==a)return"";var b=new Date(a);return b.getDate()+"/"+(b.getMonth()+1)+"/"+b.getFullYear()},updateOrder:function(a,b){$(a).each(function(a){console.log(a),$(this).find(b).html(a+1)})},isElementHidden:function(a){return"none"===a.css("display")},isElementShown:function(a){return"block"===a.css("display")}};